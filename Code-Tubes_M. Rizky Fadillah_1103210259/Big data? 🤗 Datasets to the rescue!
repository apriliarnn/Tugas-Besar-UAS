{"cells":[{"cell_type":"markdown","metadata":{"id":"DXTRkRfzpBhk"},"source":["# Big data? ü§ó Datasets to the rescue!"]},{"cell_type":"markdown","metadata":{"id":"KscVkg8PpBhm"},"source":["Install the Transformers, Datasets, and Evaluate libraries to run this notebook."]},{"cell_type":"code","execution_count":null,"metadata":{"id":"fXf00_NbpBhm"},"outputs":[],"source":["!pip install datasets evaluate transformers[sentencepiece]"]},{"cell_type":"markdown","source":["Kode ini menginstal library yang diperlukan untuk pengembangan proyek NLP, termasuk datasets untuk memuat dan mengelola dataset, evaluate untuk mengevaluasi kinerja model, dan transformers[sentencepiece] untuk bekerja dengan model-model canggih dari Hugging Face yang menggunakan SentencePiece tokenizer, sehingga memudahkan implementasi dan eksperimen dengan berbagai model bahasa alami."],"metadata":{"id":"CqzM7S0opDEE"}},{"cell_type":"code","execution_count":null,"metadata":{"id":"F5FgIpvLpBhn"},"outputs":[],"source":["!pip install zstandard"]},{"cell_type":"code","execution_count":null,"metadata":{"id":"15qyikW_pBhn","outputId":"12ceb47d-00bc-4aca-fdcb-367ea5bc90bb"},"outputs":[{"data":{"text/plain":["Dataset({\n","    features: ['meta', 'text'],\n","    num_rows: 15518009\n","})"]},"execution_count":null,"metadata":{},"output_type":"execute_result"}],"source":["from datasets import load_dataset\n","\n","# This takes a few minutes to run, so go grab a tea or coffee while you wait :)\n","data_files = \"https://huggingface.co/datasets/qualis2006/PUBMED_title_abstracts_2020_baseline/resolve/main/PUBMED_title_abstracts_2020_baseline.jsonl.zst\"\n","pubmed_dataset = load_dataset(\"json\", data_files=data_files, split=\"train\")\n","pubmed_dataset"]},{"cell_type":"code","execution_count":null,"metadata":{"id":"orHVyDwjpBho","outputId":"40f66c2b-c22c-4346-e418-24091da31514"},"outputs":[{"data":{"text/plain":["{'meta': {'pmid': 11409574, 'language': 'eng'},\n"," 'text': 'Epidemiology of hypoxaemia in children with acute lower respiratory infection.\\nTo determine the prevalence of hypoxaemia in children aged under 5 years suffering acute lower respiratory infections (ALRI), the risk factors for hypoxaemia in children under 5 years of age with ALRI, and the association of hypoxaemia with an increased risk of dying in children of the same age ...'}"]},"execution_count":null,"metadata":{},"output_type":"execute_result"}],"source":["pubmed_dataset[0]"]},{"cell_type":"code","execution_count":null,"metadata":{"id":"k3ZpePgPpBho"},"outputs":[],"source":["!pip install psutil"]},{"cell_type":"code","execution_count":null,"metadata":{"id":"rKtXQHPUpBho","outputId":"d89c5b5c-1599-43f7-8b49-064b288a6dab"},"outputs":[{"data":{"text/plain":["RAM used: 5678.33 MB"]},"execution_count":null,"metadata":{},"output_type":"execute_result"}],"source":["import psutil\n","\n","# Process.memory_info is expressed in bytes, so convert to megabytes\n","print(f\"RAM used: {psutil.Process().memory_info().rss / (1024 * 1024):.2f} MB\")"]},{"cell_type":"code","execution_count":null,"metadata":{"id":"INz1LRR7pBhp","outputId":"384971f2-c03d-40b3-a640-c69df2eeb97b"},"outputs":[{"data":{"text/plain":["Number of files in dataset : 20979437051\n","Dataset size (cache file) : 19.54 GB"]},"execution_count":null,"metadata":{},"output_type":"execute_result"}],"source":["print(f\"Number of files in dataset : {pubmed_dataset.dataset_size}\")\n","size_gb = pubmed_dataset.dataset_size / (1024**3)\n","print(f\"Dataset size (cache file) : {size_gb:.2f} GB\")"]},{"cell_type":"code","execution_count":null,"metadata":{"id":"AZVAvaLUpBhp","outputId":"5d77652f-88c2-412f-d6f2-befd47496ebc"},"outputs":[{"data":{"text/plain":["'Iterated over 15518009 examples (about 19.5 GB) in 64.2s, i.e. 0.304 GB/s'"]},"execution_count":null,"metadata":{},"output_type":"execute_result"}],"source":["import timeit\n","\n","code_snippet = \"\"\"batch_size = 1000\n","\n","for idx in range(0, len(pubmed_dataset), batch_size):\n","    _ = pubmed_dataset[idx:idx + batch_size]\n","\"\"\"\n","\n","time = timeit.timeit(stmt=code_snippet, number=1, globals=globals())\n","print(\n","    f\"Iterated over {len(pubmed_dataset)} examples (about {size_gb:.1f} GB) in \"\n","    f\"{time:.1f}s, i.e. {size_gb/time:.3f} GB/s\"\n",")"]},{"cell_type":"code","execution_count":null,"metadata":{"id":"gzPmn3xjpBhp"},"outputs":[],"source":["pubmed_dataset_streamed = load_dataset(\n","    \"json\", data_files=data_files, split=\"train\", streaming=True\n",")"]},{"cell_type":"code","execution_count":null,"metadata":{"id":"-j1XwS76pBhp","outputId":"6c1dbfd3-4887-4758-8388-5a1ae73f943f"},"outputs":[{"data":{"text/plain":["{'meta': {'pmid': 11409574, 'language': 'eng'},\n"," 'text': 'Epidemiology of hypoxaemia in children with acute lower respiratory infection.\\nTo determine the prevalence of hypoxaemia in children aged under 5 years suffering acute lower respiratory infections (ALRI), the risk factors for hypoxaemia in children under 5 years of age with ALRI, and the association of hypoxaemia with an increased risk of dying in children of the same age ...'}"]},"execution_count":null,"metadata":{},"output_type":"execute_result"}],"source":["next(iter(pubmed_dataset_streamed))"]},{"cell_type":"code","execution_count":null,"metadata":{"id":"o3Oafu32pBhp","outputId":"9fe179e4-d3fc-4a8b-bd13-f4fa739c6853"},"outputs":[{"data":{"text/plain":["{'input_ids': [101, 4958, 5178, 4328, 6779, ...], 'attention_mask': [1, 1, 1, 1, 1, ...]}"]},"execution_count":null,"metadata":{},"output_type":"execute_result"}],"source":["from transformers import AutoTokenizer\n","\n","tokenizer = AutoTokenizer.from_pretrained(\"distilbert-base-uncased\")\n","tokenized_dataset = pubmed_dataset_streamed.map(lambda x: tokenizer(x[\"text\"]))\n","next(iter(tokenized_dataset))"]},{"cell_type":"code","execution_count":null,"metadata":{"id":"LK7oTgUSpBhq","outputId":"62891f54-4af8-4e37-ac1a-f0cdb7275676"},"outputs":[{"data":{"text/plain":["{'meta': {'pmid': 11410799, 'language': 'eng'},\n"," 'text': 'Randomized study of dose or schedule modification of granulocyte colony-stimulating factor in platinum-based chemotherapy for elderly patients with lung cancer ...'}"]},"execution_count":null,"metadata":{},"output_type":"execute_result"}],"source":["shuffled_dataset = pubmed_dataset_streamed.shuffle(buffer_size=10_000, seed=42)\n","next(iter(shuffled_dataset))"]},{"cell_type":"code","execution_count":null,"metadata":{"id":"pPZBrqg_pBhq","outputId":"e3432344-a4d1-44bc-aa23-be7519ec034a"},"outputs":[{"data":{"text/plain":["[{'meta': {'pmid': 11409574, 'language': 'eng'},\n","  'text': 'Epidemiology of hypoxaemia in children with acute lower respiratory infection ...'},\n"," {'meta': {'pmid': 11409575, 'language': 'eng'},\n","  'text': 'Clinical signs of hypoxaemia in children with acute lower respiratory infection: indicators of oxygen therapy ...'},\n"," {'meta': {'pmid': 11409576, 'language': 'eng'},\n","  'text': \"Hypoxaemia in children with severe pneumonia in Papua New Guinea ...\"},\n"," {'meta': {'pmid': 11409577, 'language': 'eng'},\n","  'text': 'Oxygen concentrators and cylinders ...'},\n"," {'meta': {'pmid': 11409578, 'language': 'eng'},\n","  'text': 'Oxygen supply in rural africa: a personal experience ...'}]"]},"execution_count":null,"metadata":{},"output_type":"execute_result"}],"source":["dataset_head = pubmed_dataset_streamed.take(5)\n","list(dataset_head)"]},{"cell_type":"code","execution_count":null,"metadata":{"id":"70kkHh3tpBhq"},"outputs":[],"source":["# Skip the first 1,000 examples and include the rest in the training set\n","train_dataset = shuffled_dataset.skip(1000)\n","# Take the first 1,000 examples for the validation set\n","validation_dataset = shuffled_dataset.take(1000)"]},{"cell_type":"code","execution_count":null,"metadata":{"id":"CJZks_1KpBhq","outputId":"c8bb8df8-6a1e-4c1e-d3bc-0b894bd4ab5c"},"outputs":[{"data":{"text/plain":["{'meta': {'case_ID': '110921.json',\n","  'case_jurisdiction': 'scotus.tar.gz',\n","  'date_created': '2010-04-28T17:12:49Z'},\n"," 'text': '\\n461 U.S. 238 (1983)\\nOLIM ET AL.\\nv.\\nWAKINEKONA\\nNo. 81-1581.\\nSupreme Court of United States.\\nArgued January 19, 1983.\\nDecided April 26, 1983.\\nCERTIORARI TO THE UNITED STATES COURT OF APPEALS FOR THE NINTH CIRCUIT\\n*239 Michael A. Lilly, First Deputy Attorney General of Hawaii, argued the cause for petitioners. With him on the brief was James H. Dannenberg, Deputy Attorney General...'}"]},"execution_count":null,"metadata":{},"output_type":"execute_result"}],"source":["law_dataset_streamed = load_dataset(\n","    \"json\",\n","    data_files=\"https://the-eye.eu/public/AI/pile_preliminary_components/FreeLaw_Opinions.jsonl.zst\",\n","    split=\"train\",\n","    streaming=True,\n",")\n","next(iter(law_dataset_streamed))"]},{"cell_type":"code","execution_count":null,"metadata":{"id":"BMWk43zipBhq","outputId":"2aba270d-0279-4da6-f0d4-55b5a3439599"},"outputs":[{"data":{"text/plain":["[{'meta': {'pmid': 11409574, 'language': 'eng'},\n","  'text': 'Epidemiology of hypoxaemia in children with acute lower respiratory infection ...'},\n"," {'meta': {'case_ID': '110921.json',\n","   'case_jurisdiction': 'scotus.tar.gz',\n","   'date_created': '2010-04-28T17:12:49Z'},\n","  'text': '\\n461 U.S. 238 (1983)\\nOLIM ET AL.\\nv.\\nWAKINEKONA\\nNo. 81-1581.\\nSupreme Court of United States.\\nArgued January 19, 1983.\\nDecided April 26, 1983.\\nCERTIORARI TO THE UNITED STATES COURT OF APPEALS FOR THE NINTH CIRCUIT\\n*239 Michael A. Lilly, First Deputy Attorney General of Hawaii, argued the cause for petitioners. With him on the brief was James H. Dannenberg, Deputy Attorney General...'}]"]},"execution_count":null,"metadata":{},"output_type":"execute_result"}],"source":["from itertools import islice\n","from datasets import interleave_datasets\n","\n","combined_dataset = interleave_datasets([pubmed_dataset_streamed, law_dataset_streamed])\n","list(islice(combined_dataset, 2))"]},{"cell_type":"code","execution_count":null,"metadata":{"id":"QhEQgAItpBhq","outputId":"c2b2b3af-f459-4475-a7c5-19f5c9ecfa29"},"outputs":[{"data":{"text/plain":["{'meta': {'pile_set_name': 'Pile-CC'},\n"," 'text': 'It is done, and submitted. You can play ‚ÄúSurvival of the Tastiest‚Äù on Android, and on the web...'}"]},"execution_count":null,"metadata":{},"output_type":"execute_result"}],"source":["base_url = \"https://the-eye.eu/public/AI/pile/\"\n","data_files = {\n","    \"train\": [base_url + \"train/\" + f\"{idx:02d}.jsonl.zst\" for idx in range(30)],\n","    \"validation\": base_url + \"val.jsonl.zst\",\n","    \"test\": base_url + \"test.jsonl.zst\",\n","}\n","pile_dataset = load_dataset(\"json\", data_files=data_files, streaming=True)\n","next(iter(pile_dataset[\"train\"]))"]}],"metadata":{"colab":{"name":"Big data? ü§ó Datasets to the rescue!","provenance":[{"file_id":"https://github.com/huggingface/notebooks/blob/master/course/en/chapter5/section4.ipynb","timestamp":1735999653702}]},"language_info":{"name":"python"}},"nbformat":4,"nbformat_minor":0}